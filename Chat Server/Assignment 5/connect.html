<!DOCTYPE html>
<html>
	<head>
		<title>Connection Page</title>
		<link rel="stylesheet" type="text/css" href="connect.css">
		<script type="text/javascript" src="java_socket_bridge.js"></script>
		<script type="text/javascript" src="connect.js"></script>
		<script src="jquery-1.11.1.js"></script>
		<script type="text/javascript">

		$(document).ready(function(){
  			$("#chatEnter").keypress(function(e){
   				if (!e) e = window.event;
    				var keyCode = e.keyCode || e.which;
    			if (keyCode == '13'){
      			// Enter pressed
      			if(selected == null){
      				socket_send($("#chatEnter").val());
      				if($("#chatEnter").val() == "BYE"){
      					socket_disconnect();
      					$("#textArea").text("");
      					document.getElementById("chatPage").hidden = true;
			        	document.getElementById("connectFormDiv").hidden = false;
      				}
      			}
      			else{
      				var s = "SEND "+selected.text()+" "+$("#chatEnter").val();
      				var area = document.getElementById("textArea");
		  			area.innerHTML += "Private Message To "+selected.text()+": "+$("#chatEnter").val()+"\n";
      				socket_send(s);
      			}
      			$("#chatEnter").val("");
    		}
  			});
		}); 

		function run(){
			connected = socket_connect(document.getElementById("IPInput").value, parseInt(document.getElementById("PortInput").value));
			
			if(connected){
				selected = null;
				socket_send(retrieveName());		
				document.getElementById("chatPage").hidden = false;
			    document.getElementById("connectFormDiv").hidden = true;
			}
		}

		function on_socket_get(message){
		  if(message.indexOf("$USER_LIST$:") == 0){
		  		request_users_list(message);
		  	}
		  else{
		  	var area = document.getElementById("textArea");
		  	area.innerHTML += message+"\n";
		  }
		}

		function kill(){
			socket_send("BYE");
			socket_disconnect();
		}


	</script>
	</head>
	<body onbeforeunload="kill()">
		<applet id="JavaSocketBridge"
			archive="JavaSocketBridge.jar"
			code="JavaSocketBridge.class"
			width="0"
			height="0">
		</applet>

		<div id = "chatPage" class="chat" hidden>
			<div id = "chatDiv" class = "chat">
				<textarea id ="textArea" class = "chat" readonly> </textarea>
				<input id="chatEnter" class = "chat" type ="text" value ="" placeholder="Type message here...">
			</div>
			
			<div id="usersDiv" class = "chat">
			</div>

		</div>	

		<div id = "connectFormDiv" class ="chat">
				
						<label>IP Address</label>
						<input type = "text" id = "IPInput">
						<br>
						<label>Port</label>
						<input type = "text" id = "PortInput">
						<br>
						<button type="button" onclick="run()">Connect</button>
						<br> 
					
				<a href="https://drive.google.com/file/d/0B1M3AsJtJ5e8c2t1YXZvQTBZMUU/edit?usp=sharing">
			Click here to download the server</a>
		</div>

	</body>
</html>